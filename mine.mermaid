classDiagram
    direction TB
    
    class Server {
        ğŸ“¡ Network & Management
        ---
        -serverSocket: int
        -port: int
        -password: string
        -pollfds: vector~pollfd~
        -clients: map~intâ†’Client*~
        -channels: map~stringâ†’Channel*~
        -running: bool
        ---
        âš™ï¸ Core Methods
        ---
        +init() void
        +run() void
        +shutdown() void
        ---
        ğŸ”Œ Connection
        ---
        +acceptNewClient() void
        +handleClientData(fd) void
        +removeClient(fd) void
        ---
        ğŸ“¨ Communication
        ---
        +processCommand(client, cmd) void
        +sendToClient(fd, msg) void
        +broadcast(msg, exclude) void
        ---
        ğŸ” Lookup
        ---
        +findClientByNick(nick) Client*
        +findClientByFd(fd) Client*
        +findChannel(name) Channel*
        +createChannel(name, creator) Channel*
    }
    
    class Client {
        ğŸ‘¤ User Identity
        ---
        -fd: int
        -nickname: string
        -username: string
        -realname: string
        -hostname: string
        ---
        ğŸ” Authentication State
        ---
        -authenticated: bool
        -registered: bool
        -hasNick: bool
        -hasUser: bool
        ---
        ğŸ“¥ Buffer & Channels
        ---
        -buffer: string
        -channels: set~Channel*~
        ---
        âœ… State Checks
        ---
        +isAuthenticated() bool
        +isRegistered() bool
        +isInChannel(ch) bool
        ---
        ğŸ“ Getters/Setters
        ---
        +getNickname() string
        +setNickname(nick) void
        +getPrefix() string
        ---
        ğŸ“¨ Message Handling
        ---
        +appendToBuffer(data) void
        +extractMessage() string
        +hasCompleteMessage() bool
        ---
        ğŸ  Channel Management
        ---
        +addChannel(ch) void
        +removeChannel(ch) void
        +getChannels() set
    }
    
    class Channel {
        ğŸ·ï¸ Identity
        ---
        -name: string
        -topic: string
        -creationTime: time_t
        ---
        ğŸ‘¥ Members
        ---
        -members: map~Client*â†’isOp~
        -invitedUsers: set~Client*~
        ---
        ğŸ”’ Channel Modes
        ---
        -inviteOnly: bool (+i)
        -topicRestricted: bool (+t)
        -key: string (+k)
        -userLimit: int (+l)
        ---
        ğŸ‘¤ Member Management
        ---
        +addMember(client, isOp) void
        +removeMember(client) void
        +isMember(client) bool
        +isOperator(client) bool
        +setOperator(client, op) void
        ---
        ğŸ« Invite System
        ---
        +addInvite(client) void
        +isInvited(client) bool
        +removeInvite(client) void
        ---
        ğŸ“¢ Broadcasting
        ---
        +broadcast(msg, exclude) void
        +getMembersList() string
        ---
        âš™ï¸ Settings
        ---
        +setTopic(topic, setter) void
        +setKey(key) void
        +setUserLimit(limit) void
        +setInviteOnly(mode) void
        +setTopicRestricted(mode) void
        +getModesString() string
    }
    
    class Command {
        <<abstract>>
        ---
        #server: Server*
        #client: Client*
        #params: vector~string~
        ---
        +execute()* void
        #sendReply(code, msg) void
        #sendError(code, msg) void
    }
    
    class MessageParser {
        <<utility>>
        ---
        +parse(message) pair
        +split(str, delim) vector
        +trim(str) string
        +extractCommand(msg) string
        +extractParams(msg) vector
    }
    
    class NumericReplies {
        <<constants>>
        ---
        RPL_WELCOME = "001"
        RPL_TOPIC = "332"
        RPL_NAMREPLY = "353"
        ERR_NOSUCHNICK = "401"
        ERR_CHANOPRIVSNEEDED = "482"
        etc...
        ---
        +format(code, client, msg) string
    }
    
    class CommandFactory {
        <<factory>>
        ---
        +createCommand(name, srv, cli, params) Command*
    }
    
    %% Specific Commands (simplified)
    class PassCommand
    class NickCommand
    class UserCommand
    class JoinCommand
    class PrivmsgCommand
    class KickCommand
    class ModeCommand
    
    %% Relationships with labels
    Server "1" -- "0..*" Client : manages â–¶
    Server "1" -- "0..*" Channel : owns â–¶
    Client "0..*" -- "0..*" Channel : participates in â¬Œ
    
    Server ..> MessageParser : uses â–¶
    Server ..> CommandFactory : creates commands â–¶
    
    Command <|.. PassCommand : implements
    Command <|.. NickCommand : implements
    Command <|.. UserCommand : implements
    Command <|.. JoinCommand : implements
    Command <|.. PrivmsgCommand : implements
    Command <|.. KickCommand : implements
    Command <|.. ModeCommand : implements
    
    Command --> Server : references
    Command --> Client : references
    Command ..> NumericReplies : uses
    Command ..> Channel : modifies
    
    CommandFactory ..> Command : creates â–¶
    
    note for Server "Single poll() event loop\nManages all connections\nNo forking"
    note for Client "Can be in multiple\nchannels simultaneously"
    note for Channel "Stores operators as\nmap value (bool)"
    note for Command "Command Pattern:\nEach command is\nits own class"